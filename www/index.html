<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
      cross.stream - Local-first event streaming for hackers & tinkerers
    </title>
    <meta
      name="description"
      content="Think SQLite, but for event sourcing. Append events, react in real-time, and wire up anythingâ€”from Arduino sensors to MCP serversâ€”without cloud lock-in."
    >
    <link rel="stylesheet" href="global.css">
    <link rel="stylesheet" href="styles.css">
    <script type="module" src="components/terminal-panel.js"></script>
    <script type="module" src="components/terminal-line.js"></script>
    <script type="module" src="components/event-bubble.js"></script>
    <script type="module" src="components/cross-stream-title.js"></script>
  </head>
  <body>
    <main>
      <h1><cross-stream-title></cross-stream-title></h1>
      <p class="tagline">
        Local-first event streaming for hackers & tinkerers
      </p>

      <!-- Query Section -->
      <div class="query-section">
        <terminal-panel
          id="query-terminal"
          title="Query the Event Store"
        >
          <div id="query-output"></div>
        </terminal-panel>
      </div>

      <div class="input-store-row">
        <!-- Input commands showing executed commands -->
        <div class="console">
          <terminal-panel>
            <terminal-line
              prompt="$"
              command='"buy groceries"'
              pipe="|"
              topic=".append goal"
            ></terminal-line>
            <terminal-line
              prompt="$"
              command='"quick note about meeting"'
              pipe="|"
              topic=".append notes"
            ></terminal-line>
            <terminal-line
              prompt="$"
              command='"submit TPS report"'
              pipe="|"
              topic=".append notes"
            ></terminal-line>
            <terminal-line
              prompt="$"
              command='"learn cross.stream"'
              pipe="|"
              topic=".append goal"
            ></terminal-line>
            <terminal-line
              prompt="$"
              command='"review project docs"'
              pipe="|"
              topic=".append notes"
            ></terminal-line>
          </terminal-panel>
        </div>

        <!-- Store with event bubbles -->
        <div class="store">
          <terminal-panel>
            <terminal-line
              prompt="$"
              command="xs serve (xs-addr)"
            ></terminal-line>
            <div
              class="embedded-component"
              data-variant="store"
              id="events-container"
            >
              <event-bubble
                type="goal"
                content="buy groceries"
                event-id="03d4q1o70y6ek0ig8hwy9q00n"
              >
              </event-bubble>
              <event-bubble
                type="notes"
                content="quick note about meeting"
                event-id="03d4q1qhbiv09ovtuhokw5yxv"
              >
              </event-bubble>
              <event-bubble
                type="notes"
                content="submit TPS report"
                event-id="03d4qbrxizqgav09m7hicksb0"
              >
              </event-bubble>
              <event-bubble
                type="goal"
                content="learn cross.stream"
                event-id="03d4qic9vqkve1krajjtlbavd"
              >
              </event-bubble>
              <event-bubble
                type="notes"
                content="review project docs"
                event-id="03d4qjwnhwudlfyg1ygemmt7b"
              >
              </event-bubble>
            </div>
          </terminal-panel>
        </div>
      </div>

      <p class="tagline">
        Think SQLite, but for event sourcing. Append events, react in real-time,
        and wire up anythingâ€”from Arduino sensors to MCP serversâ€”without cloud
        lock-in.
      </p>

      <div class="cta-buttons">
        <a
          href="https://github.com/cablehead/xs"
          class="cta-button primary"
        >Get Started</a>
        <a
          href="https://cablehead.github.io/xs/"
          class="cta-button secondary"
        >Documentation</a>
      </div>

      <!-- Core Ideas Section -->
      <div class="features-grid">
        <div class="feature-card">
          <h3>ğŸ“¦ Event Store</h3>
          <p>
            Append-only stream with content-addressable storage (CAS). Separate
            metadata from content for speed.
          </p>
        </div>
        <div class="feature-card">
          <h3>ğŸ”„ Generators</h3>
          <p>
            Continuously pull data from files, APIs, websockets, serial devices,
            or sensors.
          </p>
        </div>
        <div class="feature-card">
          <h3>âš¡ Handlers</h3>
          <p>
            React to incoming frames with stateful processorsâ€”transform,
            trigger, fan-out.
          </p>
        </div>
        <div class="feature-card">
          <h3>ğŸ¯ Commands</h3>
          <p>
            On-demand, stateless ops. Perfect for RPC-style calls or streaming
            data back to the caller.
          </p>
        </div>
        <div class="feature-card">
          <h3>ğŸ”’ Local-First</h3>
          <p>
            Single binary, file-based store, Unix socket API. No cloud, works
            offline.
          </p>
        </div>
        <div class="feature-card">
          <h3>ğŸš Nushell Integration</h3>
          <p>
            Write handlers and generators in Nushell with strong typing and
            structured pipelines.
          </p>
        </div>
      </div>

      <!-- Nushell Quickstart Section -->
      <div class="code-block">
        <terminal-panel title="Hello world">
          <terminal-line
            prompt="$"
            command="xs serve ./store"
          ></terminal-line>
          <terminal-line
            prompt="$"
            command='"Hello, world!"'
            pipe="|"
            topic=".append greeting"
          ></terminal-line>
          <terminal-line prompt="$" command=".cat --follow"></terminal-line>
        </terminal-panel>
      </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <p class="footer-tagline">
        <strong>Built for people who prefer building over configuring.</strong>
      </p>
      <div class="footer-links">
        <a href="https://github.com/cablehead/xs">GitHub</a>
        <a href="https://cablehead.github.io/xs/">Docs</a>
        <a href="https://discord.com/invite/YNbScHBHrh">Discord</a>
        <a href="https://www.nushell.sh/">Nushell</a>
      </div>
    </footer>

    <script>
      // Events are read from event-bubble elements
      function getEvents() {
        return Array.from(document.querySelectorAll("event-bubble"))
          .map((bubble) => ({
            topic: bubble.type,
            content: bubble.content,
          }));
      }

      let activeQuery = null;

      document.addEventListener("DOMContentLoaded", function () {
        // Set up terminal actions via JavaScript
        const queryTerminal = document.getElementById("query-terminal");
        queryTerminal.actions = [
          { id: "notes", title: "Get all notes", selected: true },
          { id: "goal", title: "Get current goal" },
        ];

        // Handle action clicks from terminal panel
        queryTerminal.addEventListener("action-click", function (e) {
          const { actionId } = e.detail;
          executeQuery(actionId);
        });

        // Set default query to "Get all notes"
        executeQuery("notes");
      });

      function executeQuery(type) {
        // Reset all event highlighting
        document.querySelectorAll("event-bubble").forEach((bubble) => {
          bubble.style.opacity = "1";
          bubble.style.transform = "scale(1)";
        });

        activeQuery = type;

        // Show results and highlight relevant events
        showQueryResults(type);
        highlightMatchingEvents(type);
      }

      function showQueryResults(type) {
        const queryOutput = document.getElementById("query-output");
        let output = "";

        if (type === "notes") {
          output = `<div class="terminal-line">
              <span class="prompt">$</span>
              <span class="command">.cat | where topic == "notes" | insert content { .cas $in.hash }</span>
            </div>
            <pre class="terminal-output" data-variant="table">â”Œâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ # â”‚ topic â”‚                content                  â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0 â”‚ notes â”‚ quick note about meeting                â”‚
â”‚ 1 â”‚ notes â”‚ submit TPS report                       â”‚
â”‚ 2 â”‚ notes â”‚ review project docs                     â”‚
â””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre>`;
        } else if (type === "goal") {
          output = `<div class="terminal-line">
              <span class="prompt">$</span>
              <span class="command">.head goal | .cas</span>
            </div>
            <pre class="terminal-output">learn cross.stream</pre>`;
        }

        queryOutput.innerHTML = output;
      }

      function highlightMatchingEvents(type) {
        document.querySelectorAll("event-bubble").forEach((bubble) => {
          bubble.style.opacity = "0.3";
          bubble.style.transform = "scale(0.95)";
        });

        if (type === "notes") {
          // Highlight all notes events
          document.querySelectorAll("event-bubble[type='notes']")
            .forEach(
              (bubble) => {
                bubble.style.opacity = "1";
                bubble.style.transform = "scale(1)";
              },
            );
        } else if (type === "goal") {
          // Highlight only the latest goal event
          const goalBubbles = document.querySelectorAll(
            "event-bubble[type='goal']",
          );
          if (goalBubbles.length > 0) {
            const latestGoal = goalBubbles[goalBubbles.length - 1];
            latestGoal.style.opacity = "1";
            latestGoal.style.transform = "scale(1)";
          }
        }

        // Keep highlighting while query is active
      }
    </script>
  </body>
</html>
