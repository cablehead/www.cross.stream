<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cross.stream - Event Flow</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        background: #0d1117;
        color: #c9d1d9;
        font-family:
          "SF Mono", "Monaco", "Inconsolata", "Roboto Mono",
          "Source Code Pro", "Consolas", "Courier New", monospace;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      h1 {
        text-align: center;
        color: #58a6ff;
        margin-bottom: 10px;
      }
      .subtitle {
        text-align: center;
        color: #8b949e;
        margin-bottom: 30px;
      }
      .hero-layout {
        display: grid;
        grid-template-columns: 1fr;
        grid-template-rows: auto auto;
        gap: 40px;
        align-items: center;
        min-height: 400px;
      }

      .input-store-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 60px;
        align-items: start;
        width: 100%;
        position: relative;
      }
      .console {
        position: relative;
      }
      .store {
        position: relative;
      }

      .arrow {
        position: absolute;
        top: 50%;
        right: -30px;
        transform: translateY(-50%);
        width: 20px;
        height: 2px;
        background: #58a6ff;
        z-index: 10;
      }
      .arrow::after {
        content: "";
        position: absolute;
        right: -8px;
        top: -4px;
        width: 0;
        height: 0;
        border-left: 8px solid #58a6ff;
        border-top: 5px solid transparent;
        border-bottom: 5px solid transparent;
      }
      .query-section {
        display: block;
      }

      /* Terminal Panel Component System */
      .terminal-panel {
        background: #1e1e1e;
        border: 1px solid #30363d;
        border-radius: 8px;
        overflow: hidden;
        font-family:
          "Courier New", "Courier", "Lucida Console", "Liberation Mono",
          "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Monaco", monospace;
      }

      .terminal-header {
        background: #21262d;
        border-bottom: 1px solid #30363d;
        padding: 8px 20px 8px 85px;
        display: flex;
        align-items: center;
        gap: 20px;
        position: relative;
        min-height: 44px;
        box-sizing: border-box;
      }

      .terminal-header::before {
        content: "";
        position: absolute;
        top: 16px;
        left: 16px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #ff5f56;
        box-shadow: 20px 0 0 #ffbd2e, 40px 0 0 #27ca3f;
      }

      .terminal-title {
        color: #ffa657;
        font-size: 14px;
        font-weight: 600;
        margin: 0;
      }

      .terminal-actions {
        display: flex;
        gap: 10px;
        margin-left: auto;
      }

      .terminal-content {
        min-height: 200px;
        padding: 20px;
        background: #1e1e1e;
        color: #c9d1d9;
        line-height: 1.4;
        overflow-x: auto;
      }

      .terminal-line {
        margin: 10px 0;
        color: #8b949e;
        line-height: 1.4;
        white-space: nowrap;
      }

      .terminal-line .prompt {
        color: #79c0ff;
      }

      .terminal-line .command {
        color: #a5d6ff;
      }

      .terminal-line .pipe {
        color: #ff7b72;
      }

      .terminal-line .topic {
        color: #ffa657;
      }

      /* Store Section */
      .store {
        text-align: left;
      }
      .events-container {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
        margin-top: 16px;
      }
      .event-bubble {
        padding: 10px 14px;
        border-radius: 4px;
        width: 100%;
        text-align: left;
        position: relative;
        cursor: pointer;
        transition: all 0.3s ease;
        transform: scale(1);
        font-family: monospace;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1px;
        box-sizing: border-box;
      }
      .event-bubble:hover {
        transform: scale(1.02);
      }
      .event-bubble.goal {
        background: rgba(165, 162, 255, 0.15);
        border: 1px solid #a5a2ff;
        color: #a5a2ff;
      }
      .event-bubble.notes {
        background: rgba(121, 192, 255, 0.15);
        border: 1px solid #79c0ff;
        color: #79c0ff;
      }
      .event-id {
        font-size: 10px;
        opacity: 0.7;
        font-family: monospace;
        letter-spacing: -0.5px;
      }

      .command-option {
        background: #0d1117;
        border: 1px solid #30363d;
        border-radius: 4px;
        padding: 8px 12px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .command-option:hover {
        border-color: #58a6ff;
        background: rgba(88, 166, 255, 0.05);
      }

      .command-option.selected {
        border-color: #58a6ff;
        background: rgba(88, 166, 255, 0.1);
      }

      .command-title {
        color: #58a6ff;
        font-weight: 500;
        margin: 0;
        font-size: 12px;
      }
      .terminal-output {
        margin-top: 16px;
        white-space: pre-wrap;
        font-family: inherit;
      }

      .terminal-output[data-variant="table"] {
        color: #c9d1d9;
        line-height: 1.2;
      }

      .terminal-output[data-variant="text"] {
        color: #a5a2ff;
        font-size: 16px;
        font-weight: 500;
      }

      .embedded-component {
        margin-top: 16px;
      }

      .embedded-component[data-variant="store"] {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .no-output {
        color: #8b949e;
        font-style: italic;
        text-align: center;
        margin-top: 80px;
        font-size: 14px;
      }

      @media (max-width: 768px) {
        .query-section {
          grid-template-columns: 1fr;
          gap: 20px;
        }
      }

      @media (max-width: 400px) {
        .input-store-row {
          grid-template-columns: 1fr;
          gap: 30px;
          text-align: center;
        }
        .query-section {
          grid-template-columns: 1fr;
          gap: 20px;
        }
        .arrow {
          display: none;
        }
        .terminal-line {
          white-space: pre-wrap;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>cross.stream Event Flow</h1>
      <p class="subtitle">
        Events sit in the store, ready to be queried by different pipelines
      </p>

      <!-- Query Section -->
      <div class="query-section">
        <div class="terminal-panel">
          <div class="terminal-header">
            <div class="terminal-title">Query the Event Store</div>
            <div class="terminal-actions">
              <div class="command-option" id="command-notes">
                <div class="command-title">Get all notes</div>
              </div>
              <div class="command-option" id="command-goal">
                <div class="command-title">Get current goal</div>
              </div>
            </div>
          </div>
          <div class="terminal-content">
            <div id="query-output"></div>
          </div>
        </div>
      </div>

      <div class="hero-layout">
        <!-- Top row with console, arrow, and store -->
        <div class="input-store-row">
          <!-- Input commands showing executed commands -->
          <div class="terminal-panel">
            <div class="terminal-header">
              <!-- Blank title as requested -->
            </div>
            <div class="terminal-content">
              <div class="terminal-line">
                <span class="prompt">$</span> <span class="command"
                >"buy groceries"</span> <span class="pipe">|</span> <span
                  class="topic"
                >.append goal</span>
              </div>
              <div class="terminal-line">
                <span class="prompt">$</span> <span class="command"
                >"quick note about meeting"</span> <span class="pipe">|</span>
                <span class="topic">.append notes</span>
              </div>
              <div class="terminal-line">
                <span class="prompt">$</span> <span class="command"
                >"submit TPS report"</span> <span class="pipe">|</span> <span
                  class="topic"
                >.append notes</span>
              </div>
              <div class="terminal-line">
                <span class="prompt">$</span> <span class="command"
                >"learn cross.stream"</span> <span class="pipe">|</span> <span
                  class="topic"
                >.append goal</span>
              </div>
              <div class="terminal-line">
                <span class="prompt">$</span> <span class="command"
                >"review project docs"</span> <span class="pipe">|</span> <span
                  class="topic"
                >.append notes</span>
              </div>
            </div>
            <div class="arrow"></div>
          </div>

          <!-- Store with event bubbles -->
          <div class="store">
            <div class="terminal-panel">
              <div class="terminal-header">
                <div class="terminal-title">./store</div>
              </div>
              <div class="terminal-content">
                <div class="terminal-line">
                  <span class="prompt">$</span>
                  <span class="command">job spawn { xs serve (xs-addr) }</span>
                </div>
                <div
                  class="embedded-component"
                  data-variant="store"
                  id="events-container"
                >
                  <div
                    class="event-bubble goal"
                    data-topic="goal"
                    data-content="buy groceries"
                  >
                    <span>goal</span>
                    <span class="event-id">03d4q1o70y6ek0ig8hwy9q00n</span>
                  </div>
                  <div
                    class="event-bubble notes"
                    data-topic="notes"
                    data-content="quick note about meeting"
                  >
                    <span>notes</span>
                    <span class="event-id">03d4q1qhbiv09ovtuhokw5yxv</span>
                  </div>
                  <div
                    class="event-bubble notes"
                    data-topic="notes"
                    data-content="submit TPS report"
                  >
                    <span>notes</span>
                    <span class="event-id">03d4qbrxizqgav09m7hicksb0</span>
                  </div>
                  <div
                    class="event-bubble goal"
                    data-topic="goal"
                    data-content="learn cross.stream"
                  >
                    <span>goal</span>
                    <span class="event-id">03d4qic9vqkve1krajjtlbavd</span>
                  </div>
                  <div
                    class="event-bubble notes"
                    data-topic="notes"
                    data-content="review project docs"
                  >
                    <span>notes</span>
                    <span class="event-id">03d4qjwnhwudlfyg1ygemmt7b</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Events are read from HTML data attributes
      function getEvents() {
        return Array.from(document.querySelectorAll(".event-bubble"))
          .map((bubble) => ({
            topic: bubble.dataset.topic,
            content: bubble.dataset.content,
          }));
      }

      let activeQuery = null;

      document.addEventListener("DOMContentLoaded", function () {
        // Query selection
        document.getElementById("command-notes").addEventListener(
          "click",
          function () {
            executeQuery("notes");
          },
        );

        document.getElementById("command-goal").addEventListener(
          "click",
          function () {
            executeQuery("goal");
          },
        );

        // Set default query to "Get all notes"
        executeQuery("notes");

        // Event bubble hover effects
        document.querySelectorAll(".event-bubble").forEach((bubble) => {
          bubble.addEventListener("mouseenter", function () {
            this.style.transform = "scale(1.05)";
          });
          bubble.addEventListener("mouseleave", function () {
            this.style.transform = "scale(1)";
          });
        });
      });

      function executeQuery(type) {
        // Clear previous selections
        document.querySelectorAll(".command-option").forEach((c) =>
          c.classList.remove("selected")
        );

        // Reset all event highlighting
        document.querySelectorAll(".event-bubble").forEach((bubble) => {
          bubble.style.opacity = "1";
          bubble.style.transform = "scale(1)";
        });

        // Select new command
        const command = document.getElementById(`command-${type}`);
        const terminalContent = document.getElementById(
          "terminal-content",
        );

        // Select new command (no deselection allowed)
        command.classList.add("selected");
        activeQuery = type;

        // Show results and highlight relevant events
        showQueryResults(type);
        highlightMatchingEvents(type);
      }

      function showQueryResults(type) {
        const queryOutput = document.getElementById("query-output");
        let output = "";

        if (type === "notes") {
          output = `<div class="terminal-line">
              <span class="prompt">$</span>
              <span class="command">.cat | where topic == "notes" | insert content { .cas $in.hash }</span>
            </div>
            <div class="terminal-output" data-variant="table">┌───┬───────┬─────────────────────────────────────────┐
│ # │ topic │                content                  │
├───┼───────┼─────────────────────────────────────────┤
│ 0 │ notes │ quick note about meeting                │
│ 1 │ notes │ submit TPS report                       │
│ 2 │ notes │ review project docs                     │
└───┴───────┴─────────────────────────────────────────┘</div>`;
        } else if (type === "goal") {
          output = `<div class="terminal-line">
              <span class="prompt">$</span>
              <span class="command">.head goal | .cas</span>
            </div>
            <div class="terminal-output" data-variant="text">learn cross.stream</div>`;
        }

        queryOutput.innerHTML = output;
      }

      function highlightMatchingEvents(type) {
        document.querySelectorAll(".event-bubble").forEach((bubble) => {
          bubble.style.opacity = "0.3";
          bubble.style.transform = "scale(0.95)";
        });

        if (type === "notes") {
          // Highlight all notes events
          document.querySelectorAll(".event-bubble.notes").forEach(
            (bubble) => {
              bubble.style.opacity = "1";
              bubble.style.transform = "scale(1.05)";
            },
          );
        } else if (type === "goal") {
          // Highlight only the latest goal event
          const goalBubbles = document.querySelectorAll(
            ".event-bubble.goal",
          );
          if (goalBubbles.length > 0) {
            const latestGoal = goalBubbles[goalBubbles.length - 1];
            latestGoal.style.opacity = "1";
            latestGoal.style.transform = "scale(1.05)";
          }
        }

        // Keep highlighting while query is active
      }
    </script>
  </body>
</html>
